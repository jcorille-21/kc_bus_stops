<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>King County Metro Accessibility</title>

  <!-- CSS Stylesheets-->
  <link rel="stylesheet" href="css/main.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">

  <!-- JS Scripts-->
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
</head>

<body>
  <!-- Text -->
  <div id="text">
    <div id="title">
      King County Metro Transit Accessibility
    </div>

    <div class="cred">
      <br>By Jerome Orille | GEOG 458 | Winter Quarter 2021
    </div>

    <p>
      This web map goes over King County metro accessibility. Variables are represented
      through layers, and the layers can be turned on and off. The variables shown include
      the number of bus stops per census tract, distance in miles toward the nearest
      Park and Ride per Population Weighted Centroid (PWC) and King County Railways.
      The icons can be interacted with and they give information about the data point.
      <br><br>Data sources:
      <li><a href="https://gis-kingcounty.opendata.arcgis.com/datasets/consolidated-demographics-index-for-king-county-census-tracts-demographic-index-area">Census Tracts</a></li>
      <li><a href="https://gis-kingcounty.opendata.arcgis.com/datasets/transit-stops-for-king-county-metro-transitstop-point">Transit Stops</a></li>
      <li><a href="https://gis-kingcounty.opendata.arcgis.com/datasets/king-county-metro-park-and-ride-lots-parkride-point">Park and Ride Lots</a></li>
      <li><a href="https://gis-kingcounty.opendata.arcgis.com/datasets/metro-transportation-network-tnet-in-king-county-for-railway-mode-trans-network-rail-line">Railways</a></il>
    </p>

    <div class="cred">
      Special thanks to Bo Zhao and Tyler McCrea for teaching this course
    </div>
  </div>
  <!-- Web Map -->
  <div id="map"></div>
  <script>

    <!-- Setting up the map -->
    var mymap = L.map('map', {
      maxZoom: 14,
      minZoom: 10
    }).setView([47.5, -121.9], 10);

    var dark = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
      attribution: 'Generated by Jerome Orille | University of Washington'
    }).addTo(mymap);

    var light = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth/{z}/{x}/{y}{r}.png', {
      attribution: 'Generated by Jerome Orille | University of Washington'
    });

    var streets = L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.png', {
      attribution: 'Generated by Jerome Orille | University of Washington'
    });


    <!-- Census Tracts and Bus Stops -->
    // Add census tract polygons
    var kc_tracts = L.geoJson.ajax("assets/kc_tracts.geojson", {
        style: kc_style,
        onEachFeature: function(feature, layer) {
          layer.bindPopup('Number of bus stops: ' + feature.properties.Join_Count)
        },
    }).addTo(mymap);

    // Color scheme for census tracts
    var kc_colors = chroma.scale('Greens').colors(5);

    // Style function sets color to census tracts based on number of bus stops
    function kc_style(feature) {
      return {
        fillColor: setColor(feature.properties.Join_Count),
        fillOpacity: 0.8,
        weight: 2,
        opacity: 1,
        color: '#b4b4b4',
        dashArray: '1'
      };
    }

    // setColor function creates a range of values for the color scheme
    function setColor(density) {
      var id = 0;
      if (density > 265) {
        id = 4;
      } else if (density > 149 && density <= 265) {
        id = 3;
      } else if (density > 87 && density <= 149) {
        id = 2;
      } else if (density > 45 && density <= 87) {
        id = 1;
      } else {
        id = 0;
      }
      return kc_colors[id];
    }


    <!-- Population Weighted Centroids and Park And Rides -->
    // Build up colors
    var pwc_colors = chroma.scale('Reds').colors(5);

    // Apply colors to icon
    for (i = 0; i < 5; i++) {
      $('head').append($("<style> .marker-color-" + (i + 1).toString() + " { color: " + pwc_colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }

    var pwc = L.geoJson.ajax("assets/pwc.geojson", {
      onEachFeature: function(feature, layer) {
          layer.bindPopup("Distance to nearest Park and Ride: " + Math.round(feature.properties.NEAR_DIST * 100) / 100 + " miles");
        },
        pointToLayer: function(feature, latlng) {
          var id = 0;
          if (feature.properties.NEAR_DIST <= 1.12) {
            id = 0;
          } else if (feature.properties.NEAR_DIST <= 2.27) {
            id = 1;
          } else if (feature.properties.NEAR_DIST <= 4.62) {
            id = 2;
          } else if (feature.properties.NEAR_DIST <= 11.1) {
            id = 3;
          } else {
            id = 4;
          }
          return L.marker(latlng, {
            icon: L.divIcon({
              className: 'fa fa-home marker-color-' + (id + 1).toString()
            })
          });
        }
      });

    <!-- Railways -->
    var rw_color = chroma('darkblue');
    $('head').append($("<style> .marker-color-0" + " { color: " + rw_color + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));

    var railways = L.geoJson.ajax("assets/railways.geojson", {
      style: rw_style,
      onEachFeature: function(feature, layer) {
        layer.bindPopup('Railway name: ' + feature.properties.FULLNAME_R +
                        '<br>City name: ' + feature.properties.CITY_R);
      }
    });

    // Style function sets railway color
    function rw_style(feature) {
      return {
        fillOpacity: 0.8,
        weight: 2,
        opacity: 1,
        color: rw_color
      };
    }

    <!-- Legend -->
    // Create legend
    var legend = L.control({
      position: 'topright'
    });

    // Function runs when legend is added to map
    legend.onAdd = function() {
      var div = L.DomUtil.create('div', 'legend');
      div.innerHTML += '<b>Number of Bus Stops per Census Tract</b><br/>';
      div.innerHTML += '<i style="background: ' + kc_colors[4] + '; opacity: 0.8"></i><p> > 265 </p>';
      div.innerHTML += '<i style="background: ' + kc_colors[3] + '; opacity: 0.8"></i><p> 150 - 265 </p>';
      div.innerHTML += '<i style="background: ' + kc_colors[2] + '; opacity: 0.8"></i><p> 88 - 149 </p>';
      div.innerHTML += '<i style="background: ' + kc_colors[1] + '; opacity: 0.8"></i><p> 46 - 87 </p>';
      div.innerHTML += '<i style="background: ' + kc_colors[0] + '; opacity: 0.8"></i><p> < 46 </p>';
      div.innerHTML += '<hr><b>Distance in Miles toward the nearest Park and Ride per PWC</b><br/>';
      div.innerHTML += '<i style="background: ' + pwc_colors[4] + '; opacity: 0.8"></i><p> > 11.10 </p>';
      div.innerHTML += '<i style="background: ' + pwc_colors[3] + '; opacity: 0.8"></i><p> 4.63 - 11.10 </p>';
      div.innerHTML += '<i style="background: ' + pwc_colors[2] + '; opacity: 0.8"></i><p> 2.28 - 4.62 </p>';
      div.innerHTML += '<i style="background: ' + pwc_colors[1] + '; opacity: 0.8"></i><p> 1.13 - 2.27 </p>';
      div.innerHTML += '<i style="background: ' + pwc_colors[0] + '; opacity: 0.8"></i><p> < 1.12 </p>';
      div.innerHTML += '<hr><b>King County Railways </b><br/>' + '<i style="background: ' + rw_color + '; opacity: 0.8"></i><p>Railway</p>';
      return div;
    };

    // Add legend
    legend.addTo(mymap);


    <!-- Layers -->
    var baseLayers = {
      'Dark': dark,
      'Light': light,
      'Streets': streets
    };

    var overlays = {
      'Census Tracts': kc_tracts,
      'Population-Weighted Centroids': pwc,
      'Railways': railways
    }

    L.control.layers(baseLayers, overlays, {
      collapsed: false,
      position: 'topright'
    }).addTo(mymap);


    // Add scale bar
    L.control.scale({
      position: 'bottomleft'
    }).addTo(mymap);
  </script>
</body>

</html>
